@using FairPlayShop.Common.CustomAttributes
@using FairPlayShop.Interfaces.Services
@using FairPlayShop.Models.Store
@using Microsoft.AspNetCore.Authorization
@using Microsoft.Extensions.Localization
@attribute [Route(Common.Constants.ApiRoutes.CreateMyStore)]
@attribute [Authorize]
@rendermode RenderMode.InteractiveServer

<PageTitle>
    @Localizer![CreateMyStoreTextKey]
</PageTitle>

<h3>
    @Localizer![CreateMyStoreTextKey]
</h3>

<EditForm FormName="frmCreateMyStore" Model="this.CreateStoreModel" OnValidSubmit="OnValidSubmitAsync">
    <div class="mb-3">
        <DataAnnotationsValidator></DataAnnotationsValidator>
        <ValidationSummary></ValidationSummary>
    </div>
    <div class="mb-3">
        <label class="mb-3">
            @Localizer![NameTextKey]
        </label>
        <InputText class="form-control" @bind-Value="CreateStoreModel!.Name"></InputText>
        <ValidationMessage For="@( () => CreateStoreModel.Name)"></ValidationMessage>
    </div>
    <div class="mb-3">
        <button class="btn btn-primary" type="submit">
            @Localizer[SaveTextKey]
        </button>
    </div>
</EditForm>

@code {
    [Inject]
    private IStoreService? StoreService { get; set; }
    [Inject]
    private IStringLocalizer<CreateMyStore>? Localizer { get; set; }
    [SupplyParameterFromForm]
    private CreateStoreModel? CreateStoreModel { get; set; } = new CreateStoreModel();
    private CancellationTokenSource CancellationTokenSource { get; set; } = new();

    private async Task OnValidSubmitAsync()
    {
        await this.StoreService!.CreateMyStoreAsync(this.CreateStoreModel!, CancellationTokenSource.Token);
    }

    [ResourceKey(defaultValue: "Create My Store")]
    public const string CreateMyStoreTextKey = "CreateMyStoreTextKey";
    [ResourceKey(defaultValue: "Name")]
    public const string NameTextKey = "NamtText";
    [ResourceKey(defaultValue: "Save")]
    public const string SaveTextKey = "SaveText";
}
